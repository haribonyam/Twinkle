<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/css/login.css">
    <link rel="stylesheet" type="text/css" href="/css/common.css">
    <title>반짝 로그인</title>
</head>
<body>
<header></header>
<article class="main-login">
    <ul class="login-container">
        <p>반짝회원 로그인</p>
        <li><div>아이디</div><input type="text" id="username"></li>
        <li><div>비밀번호</div><input type="password" id="password"></li>
    </ul>
    <div onclick="loginValidation()" class="login-button">로그인</div>
    <div>
        <p>회원이 아니신가요?</p>
        <p>지금 바로 가입해보세요 <a href="/join">회원가입</a></p>
    </div>
</article>
<div onclick="window.location.href='http://localhost:8080/oauth2/authorization/kakao'">카카오로그인</div>
<footer></footer>
</body>

<script>
    function loginValidation(){
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        if(username==""){
            alert("아이디를 입력하세요");
        }else if(password==""){
            alert("패스워드를 입력하세요");
        }else{
            loginPro(username,password)
        }
    }


        function loginPro(username, password) {
            let formData = new FormData();
            formData.append("username", username);
            formData.append("password", password);

            fetch(`http://localhost:8080/login`, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    alert('로그인 중 오류가 발생했습니다.');
                } else {
                    let token = response.headers.get('Authorization');
                    let nickname = response.headers.get('Nickname');
                    let id = response.headers.get("Id");
                    if (token) {

                        localStorage.setItem('jwtToken', token);
                        localStorage.setItem('nickname', nickname);
                        localStorage.setItem('id', id);

                        alert('로그인이 완료되었습니다.');
                        location.href = "/";
                    } else {
                        alert('로그인 중 오류가 발생했습니다.');
                    }
                }
            })
            .catch((error) => {
                console.error('Error:', error);
                alert('로그인 중 오류가 발생했습니다.');
            });
        }

<!--    function refreshToken(){-->
<!--    let oldAccess = localStorage.getItem('Authorization');-->
<!--    fetch('http://localhost:8080/token/refresh', {-->
<!--        method: 'POST',-->
<!--        headers: {-->
<!--            'Content-Type': 'application/json',-->
<!--            'Authorization': oldAccess-->
<!--        }-->
<!--        })-->
<!--    .then(response => {-->
<!--        if (!response.ok) {-->
<!--            alert("토큰이 만료 됐습니다. 다시 로그인 해주세요.");-->
<!--        }-->
<!--    })-->
<!--    .then(data => {-->
<!--        localStorage.setItem('Authorization', 'Bearer '+data.accessToken);-->

<!--    })-->

<!--    });-->
<!--    }-->

</script>
</html>